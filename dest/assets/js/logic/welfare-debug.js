/*! Project: vip
 *  Version: 1.0.0
 *  Date: 2015-07-20 02:03:34 PM
 *  Author: 
 */define("/assets/js/logic/welfare-debug",["../mod/login-debug","../mod/date-debug","../lib/jquery.min-debug","../lib/template.min-debug","../mod/header-debug","../mod/myinfo-debug","../mod/jquery.cookie-debug","../tpl/output/loginHder-debug","../tpl/output/template-debug","../mod/ajaxhelper-debug","../mod/dialog/dialog-debug","../mod/dialog/popup-debug","../mod/dialog/dialog-config-debug"],function(a,b,c){function d(a){C.showMsgBox(a)}function e(a){a.id="dialogPopupBox",a.skin="ui-dialog-skin-vip";var b=C.get("dialogPopupBox");b?b.content(a.content).showModal():C(a).showModal()}function f(){var a=z(this).closest("li").data("pid");z.ajax({url:B+"statisticClickNum",cache:!1,data:{id:a},dataType:"json",success:function(a){return!0}})}function g(){var a=z(this).data("flag");if(0==a)return void i(z(this).data("lottery"),this);if(1==a)h(z(this).closest("li").data("pid"),0,this);else if(2==a)h(z(this).closest("li").data("pid"),1,this);else if(3==a)return void z(this).addClass("welfare-btn-2")}function h(a,b,c){z.ajax({url:B+"exchangeProduct",dataType:"json",data:{productId:a,type:b},cache:!1,context:{maskId:c},success:function(a){x(a)||(a.result?(e({content:a.desc,okValue:"前往兑换",ok:function(){window.open(a.data.activeUrl,"_blank")}}),1==b?(z(c).closest("li").find(".welfare-left-num").html(a.data.leftNum),k(a.data.beanNum)):k(a.data.beanNum)):d(a.desc))}})}function i(a,b){z.ajax({url:B+"doLottery",dataType:"json",data:{lotteryId:a},cache:!1,context:{maskId:b},success:function(a){x(a)||(d(a.desc),a.data&&k(a.data))}})}function j(){i(z(this).data("flag"),this)}function k(a){z("#v-left-count").html(a)}function l(){if(!D&&!E){E=!0;var a=z(this).prev("div").find("ul"),b=2*parseInt(a.find("li").css("margin-left"))+a.find("li").width();a.append(a.find("li").first().clone()),a.animate({"margin-left":"-"+b+"px"},500,function(){a.removeAttr("style"),a.find("li").first().remove(),E=!1})}}function m(){if(!D&&!E){D=!0;var a=z(this).next("div").find("ul"),b=2*parseInt(a.find("li").css("margin-left"))+a.find("li").width();a.prepend(a.find("li").last().clone()),a.css("margin-left","-"+b+"px"),a.animate({"margin-left":0},500,function(){a.removeAttr("style"),a.find("li").last().remove(),D=!1})}}function n(){z.ajax({url:B+"signEveryDay",cache:!1,dataType:"json",success:function(a){-1==a.code?e({content:a.desc,okValue:"立即签到",ok:function(){window.open("http://vip.yy.com/vzone/mood/index","_blank")}}):d(a.desc)}})}function o(){z.ajax({url:B+"getEveryweekBean",cache:!1,dataType:"json",success:function(a){x(a)||d(a.desc)}})}function p(){z.ajax({url:B+"lotteryBean",cache:!1,dataType:"json",success:function(a){d(a.desc)}})}function q(a){z.ajax({url:B+"isFirstRecharge",dataType:"json",cache:!1,data:{type:a},async:!1,success:function(b){if(b.result)switch(b.code){case 0:return void(0==a?window.open("http://vip.yy.com/vip/vmall2/vipWelfare1"):window.open("http://vip.yy.com/vip/vmall2/vipWelfare2"));default:return void e(0==a?{content:b.desc,ok:function(){window.open("http://vip.yy.com/vip/vmall2/vipWelfare1")},okValue:"继续充值"}:{content:b.desc,ok:function(){window.open("http://vip.yy.com/vip/vmall2/vipWelfare2")},okValue:"继续赠送"})}d(b.desc)}})}function r(){var a=z(this);z.ajax({url:B+"loveIt",data:{productId:a.closest("li").data("pid")},dataType:"json",cache:!1,context:{maskId:this},success:function(b){b.result?a.removeClass().addClass("active"):d(b.desc)}})}function s(a){if(0==a)return"-";var b=new Date(a);return null==b?"-":b.getFullYear()+"-"+t(b.getMonth()+1)+"-"+t(b.getDate())+" "+t(b.getHours())+":"+t(b.getMinutes())+":"+t(b.getSeconds())}function t(a){return 10>a?"0"+a:a}function u(){z.ajax({url:B+"getBeanRecordList",cache:!1,dataType:"json",context:{maskId:this},success:function(a){if(a.result){if(-3==a.code)return e({content:a.desc,okValue:"赚取V豆",ok:function(){z("html,body").animate({scrollTop:z("#v-make").offset().top},500)}}),!1;var b=[];b.push('<div class="table-s1"><table></tr><th>操作</th><th>赚取/消耗</th><th>剩余</th><th>时间</th><th>有效期至</th></tr>');for(var c=0,f=a.data.length;f>c;c++)a.data[c].beanNum>0&&(a.data[c].beanNum="+"+a.data[c].beanNum),0==a.data[c].effitiveTime&&(a.data[c].remainNum="-"),b.push("<tr><td>"+a.data[c].beanSource+"</td><td>"+a.data[c].beanNum+"</td><td>"+a.data[c].remainNum+"</td><td>"+s(1e3*a.data[c].times)+"</td><td>"+s(1e3*a.data[c].effitiveTime)+"</td></tr>");b.push("</table></div>"),e({content:b.join(""),okValue:"赚取更多V豆",ok:function(){z("html,body").animate({scrollTop:z("#v-make").offset().top},500)}})}else d(a.desc)}})}function v(){z.ajax({url:B+"prizeRecord",cache:!1,dataType:"json",context:{maskId:this},success:function(a){if(a.result){if(-3==a.code)return e({content:a.desc,okValue:"赚取V豆",ok:function(){z("html,body").animate({scrollTop:z("#v-make").offset().top},500)}}),!1;var b=a.data.lotteryPrizes,c=a.data.exchangePrizes,f=[];if(f.push('<div class="table-s1"><table></tr><th>获得方式</th><th>礼品</th><th>时间</th><th>兑换码</th><th>兑换地址</th><th>兑换码有效期</th></tr>'),null!=b)for(var g=0,h=b.length;h>g;g++)f.push("<tr><td>V豆抽奖</td><td>"+b[g].prizeName+"</td><td>"+b[g].times+"</td><td>"+b[g].activeKey+'</td><td><a href="'+b[g].activeKeyLink+'" target="_blank" >点这里&raquo;</a></td><td>'+b[g].expireTime+"</td></tr>");if(null!=c)for(var g=0,h=c.length;h>g;g++)f.push("<tr><td>V豆兑换</td><td>"+c[g].prizeName+"</td><td>"+c[g].times+"</td><td>"+c[g].activeKey+'</td><td><a href="'+c[g].activeKeyLink+'" target="_blank" >点这里&raquo;</a></td><td>'+c[g].expireTime+"</td></tr>");f.push("</table><div>"),e({content:f.join("")+"<br/><br/>"})}else d(a.desc)}})}function w(){z("span.welfare-left-time").each(function(){var a=z(this).data("time"),b=new Date,c=3600*(23-b.getHours())+60*(59-b.getMinutes())+(59-b.getSeconds());a>c&&(a=c,z(this).attr("data-time",a)),0>=a?z(this).html("0时0分0秒"):z(this).html(parseInt(a/3600)+"时"+parseInt(a%3600/60)+"分"+a%3600%60+"秒")});var a=!0,b=setInterval(function(){return a=!0,z("span.welfare-left-time").each(function(){var b=z(this).attr("data-time");0>=b?z(this).html("0时0分0秒"):(z(this).html(parseInt(b/3600)+"时"+parseInt(b%3600/60)+"分"+b%3600%60+"秒"),a=!1),z(this).attr("data-time",b-1)}),a?void clearInterval(b):void 0},1e3)}function x(a){return a.result||-1!=a.code?!1:(e({content:a.desc,okValue:"成为会员",ok:function(){window.open("http://vip.yy.com/vip/vmall2/vipWelfare1","_blank")}}),!0)}var y=a("../mod/login-debug"),z=jQuery=a("../lib/jquery.min-debug"),A=a("../lib/template.min-debug"),B="/service/web/welfare/";a("../mod/header-debug"),a("../mod/ajaxhelper-debug");var C=a("../mod/dialog/dialog-debug");z(".welfare-nav").on("click","a",function(){z(this).siblings("a").removeClass("select-nav");var a=z(this).data("href");void 0!=a&&z("html,body").animate({scrollTop:z("#"+a).offset().top},500)}),y.getUserInfo(function(a){z(".welfare-p-info").html(A("vip-info",a)),y.getUserLogo(function(a){z(".welfare-p-info .info-logo").attr("src",a)})}),z("body").delegate(".login-btn","click",function(){var a=this;y.getUserInfo(function(b){b.result&&null!=b.data?z(a).trigger("login-click"):showUdbLogin()})}).delegate(".goto-left","click",m).delegate(".goto-right","click",l).delegate(".welfare-btn","login-click",g).delegate(".not-love-a","login-click",r).delegate(".do-lucky","login-click",j).delegate(".statis-a","click",f),z(document).ready(function(){z.ajax({url:B+"initInfo",cache:!1,dataType:"json",success:function(a){z("#v-left-count").html(a.data.beanNum)}}),z.ajax({url:B+"exchangeInfo",cache:!1,dataType:"json",success:function(a){z(".v-exchange-time-wrap").append(A("tpl-time-list",a.data)).find(".loading").remove(),z(".v-exchange-count-wrap").append(A("tpl-count-list",a.data)).find(".loading").remove(),w(),console.log("************ 加载兑换的物品 *************"),console.log(a.data)}}),z.ajax({url:B+"lotteryInfo",cache:!1,dataType:"json",success:function(a){z(".v-roll-area").append(A("tpl-lucky-list",a.data)).find(".loading").remove(),z(".lucky-table").append(A("tpl-dialy-lucky-list",a.data)).prev(".loading").remove()}}),z.ajax({url:"http://vip.yy.com/vip/ad?adNo=20066",cache:!1,dataType:"jsonp",success:function(a){z(".welfare-adv").html('<a href="'+a.data.url+'" target="_blank"><img width="730" height="180" src="'+a.data.images+'"/></a>')}})});var D=!1,E=!1;z(".v-make-container").bind("login-click",function(){switch(z(this).data("flag")){case 1:n();break;case 2:o();break;case 3:p();break;case 4:q(0);break;case 5:q(1)}}),z(".v-detail").bind("login-click",u),z(".v-my-gift").bind("login-click",v),z(document).ready(function(){a.async("http://yue.yy.com/common/js/yyutil-debug.js"),a.async("http://res.udb.duowan.com/js/oauth/udbsdk/proxy/udbsdkproxy.min-debug.js"),a.async("http://yue.yy.com/interface/subcribe-debug.js")})});