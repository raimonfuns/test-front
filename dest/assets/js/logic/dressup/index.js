/*! Project: vip
 *  Version: 1.0.0
 *  Date: 2015-07-20 02:03:34 PM
 *  Author: 
 */define("/assets/js/logic/dressup/index",["../../lib/jquery.min","../../lib/template.min","../../mod/header","../../mod/login","../../mod/date","../../mod/myinfo","../../mod/jquery.cookie","../../tpl/output/loginHder","../../tpl/output/template","../../mod/loginSider","../../tpl/output/loginSider","../../aralejs/slide","../../aralejs/switchable","../../araleWidget/widget","../../araleBase/base","../../araleBase/class","../../araleBase/events","../../araleBase/aspect","../../araleBase/attribute","../../araleWidget/daparser","../../araleWidget/auto-render","../../aralejs/plugins/effects","../../aralejs/plugins/easing","../../aralejs/plugins/autoplay","../../aralejs/plugins/circular"],function(a,b,c){function d(){slide=new w({element:"#slideS1",duration:300,effect:"fade",easing:"easeOutStrong",autoplay:!0,hasTriggers:!0,triggers:".ui-switchable-trigger",activeTriggerClass:"active"}).render()}function e(){var a=u(".ui-switchable-nav"),b=a.find(">li"),c=(a.outerWidth()-b.length)/b.length;b.css({width:c}),b.parent().show(),d(),a=b=c=null}function f(a,b){slide=new w({element:a,duration:300,effect:"scrollx",easing:"easeOutStrong",autoplay:!0,hasTriggers:!1,triggers:b,activeTriggerClass:"curr"}).render()}function g(a){x=u('<div id="pop-card"><img class="pop-card-loading" src="http://show.yy.com:85/assets/img/ajaxloaderbig.gif" alt=""></div>').css(y);var b=new Image;b.src=a,b.alt="",u("body").append(x),b.complete?x.html(b):b.onload=function(){x?x.html(b):""}}function h(){x.remove(),x=null}function i(a){o(),u.ajax({url:"http://show.yy.com:85/service/web/dressupcenter/exchange",type:"GET",cache:!1,data:{pid:a.pid,dressUpType:a.type},dataType:"json",success:function(b){n(),b.result?a.y&&a.y():m(b.desc)}})}function j(a){o(),u.ajax({url:"http://show.yy.com:85/service/web/dressupcenter/freeset",type:"GET",cache:!1,data:{pid:a.pid,dressUpType:a.type},dataType:"json",success:function(b){n(),b.result?a.y&&a.y():m(b.desc)}})}function k(a){u(a+" .gift").click(function(){var a=u(this);p(function(){var b={pid:a.attr("pid"),dressUpType:a.attr("type"),imid:u("#pid").val()};/^\d{5,9}$/.test(b.imid)?(n(),q(b.imid,a.attr("price"),function(){o(),u.ajax({url:"http://show.yy.com:85/service/web/dressupcenter/send",type:"GET",cache:!1,data:b,dataType:"json",success:function(a){n(),m(a.result?"赠送成功，请通知你的好友到会员装扮站设置装扮^_^":a.desc),b=null}})},function(){a.trigger("click")})):u(".tips-p").html("请输入正确的YY号")})})}function l(a){u(a+" .exchange").click(function(){var a=u(this);"1"==a.attr("free")?j({pid:a.attr("pid"),type:a.attr("type"),y:function(){m("兑换成功！")}}):r(a.attr("price"),function(){i({pid:a.attr("pid"),type:a.attr("type"),y:function(){m("兑换成功！")}})},function(){})})}function m(a,b,c){function d(a,b,c){z=u('<div class="pop-layout"></div>'),A=u('<div class="pop-layout-main"></div>'),D=b||c?u('<div class="pop-btn-box"></div>'):null,b&&(E=u('<a href="javascript:;" class="pop-yes">'+g.btnYes+"</a>"),D.append(E)),c&&(F=u('<a href="javascript:;" class="pop-no">'+g.btnNo+"</a>"),D.append(F)),G=u('<div class="pop-content">'+a+"</div>"),A.append(G).append(D),g.closeBtn&&(B=u('<a class="close-pop" id="close-pop" href="javascript:;"></a>'),A.append(B)),z.append(A),e(),u("body").append(z.css({visibility:"hidden"})),z.css({marginLeft:-z.outerWidth()/2,marginTop:-z.outerHeight()/2,width:z.outerWidth(),visibility:""}),f(b,c)}function e(){g.mask&&(C=u('<div class="mask-pop"></div>').css(g.maskStyle),u("body").append(C))}function f(a,b){g.closeBtn&&B.click(function(){n()}),a&&E.click(function(){g.clpop&&n(),a&&a()}),b&&F.click(function(){n(),b&&b()})}var g={text:"",btnYes:"确定",btnNo:"取消",closeBtn:!0,mask:!0,clpop:!0,maskStyle:{width:"100%",height:"100%",backgroundColor:"#000",filter:"alpha(Opacity=40)",opacity:"0.4",position:"fixed",left:0,top:0,zIndex:1e3}};"string"===u.type(a)&&d(a,b,c),u.isPlainObject(a)&&(u.extend(!0,g,g,a),d(g.text,b,c))}function n(){C&&C.remove(),z.remove(),z=A=B=C=D=E=F=G=null}function o(){var a={text:'<img class="pop-card-loading" src="http://show.yy.com:85/assets/img/ajaxloaderbig.gif">',closeBtn:!1};m(a),a=null}function p(a,b){var c={text:'<dl class="send-pid-dl clearfix"><dt>受赠者YY号</dt><dd><input class="send-pid" id="pid" type="text"><p class="tips-p"></p></dd></dl>',btnYes:"提交",clpop:!1};m(c,a,b),c=null}function q(a,b,c,d){var e={text:"你选择赠送给昵称为“ "+a+" ”的好友，将消耗 "+b+" 张V卡",btnNo:"返回修改"};m(e,c,d),e=null}function r(a,b,c){var d={text:"你选择的会员装扮，将消耗 "+a+" 张V卡"};m(d,b,c),d=null}function s(a){var b,c="";if(a){for(var d=0;d<a.length;d++)c+="<tr><td>"+a[d].typeName+"</td><td>"+a[d].materialName+"</td><td>"+a[d].endTime.substring(0,9)+'</td><td><a class="table-btn set" href="javascript:;" type="'+a[d].dressType+'" pid="'+a[d].pid+'">设置</a><a class="table-btn rec" href="javascript:;" type="'+a[d].dressType+'">恢复默认样式</a></td></tr>';b='<div class="pop-layout-header"><i>我的</i>装扮</div><div class="pop-layout-body my-dress-body"><table class="table-list" cellpadding="0" cellspacing="0"><colgroup width="25%"></colgroup><colgroup width="20%"></colgroup><colgroup width="20%"></colgroup><colgroup width="35%"></colgroup><tr><th>装扮类目</th><th>素材</th><th>有效期至</th><th></th></tr>'+c+"</table></div>"}else b='<div class="pop-layout-header"><i>我的</i>装扮</div><div class="pop-layout-body my-dress-body">还没有装扮素材！</div>';m(b),b=c=null}function t(a){var b,c="";if(a){for(var d=0;d<a.length;d++)c+="<tr><td>"+a[d].typeName+"</td><td>"+a[d].materialName+"</td><td>"+a[d].targetImid+"</td></tr>";b='<div class="pop-layout-header"><i>我的</i>赠送</div><div class="pop-layout-body my-gifts-body"><table class="table-list" cellpadding="0" cellspacing="0"><colgroup width="25%"></colgroup><colgroup width="20%"></colgroup><colgroup width="20%"></colgroup><colgroup width="35%"></colgroup><tr><th>装扮类目</th><th>素材</th><th>赠送对象</th></tr>'+c+"</table></div>"}else b='<div class="pop-layout-header"><i>我的</i>赠送</div><div class="pop-layout-body my-dress-body">还没有赠送过装扮素材！</div>';m(b),b=c=null}var u=jQuery=a("../../lib/jquery.min"),v=a("../../lib/template.min");a("../../mod/header"),a("../../mod/loginSider");var w=a("../../aralejs/slide");e();var x,y={width:"283px",height:"378px",position:"absolute",backgroundColor:"#fff",boxShadow:"0 0 15px #888",zIndex:99};u.ajax({url:"http://show.yy.com:85/service/web/dressupcenter/allstatuscards",type:"GET",cache:!1,dataType:"json",success:function(a){a.result&&(u("#name-plate-box").append(v("name-plate",{list:a.data})),f("#name-plate-bady","#nameplate-btn>li"),k("#name-plate-bady"),l("#name-plate-bady"))}}),u.ajax({url:"http://show.yy.com:85/service/web/dressupcenter/allspecialcards",type:"GET",cache:!1,dataType:"json",success:function(a){a.result&&(u("#name-cards-box").append(v("name-cards",{list:a.data})),f("#card-block","#card-block-btn>li"),u(".card-goods").mousemove(function(a){x?x.css({left:a.pageX+25,top:a.pageY}):(y.left=a.pageX+25,y.top=a.pageY,g("http://show.yy.com:85/assets/img/dressup/show_card.jpg"))}).mouseout(function(){h()}),k("#card-block"),l("#card-block"))}});var z,A,B,C,D,E,F,G;u(".my-dressup").click(function(){o(),u.ajax({url:"http://show.yy.com:85/service/web/dressupcenter/mydressup",type:"GET",cache:!1,dataType:"json",success:function(a){n(),a.result?(s(a.data),a.data&&(u(".set").click(function(){var a=u(this);u.ajax({url:"http://show.yy.com:85/service/web/dressupcenter/setdressup",type:"GET",cache:!1,data:{dressUpType:a.attr("type"),pid:a.attr("pid")},dataType:"json",success:function(b){b.result?a.addClass("seted").removeClass("set").html("已设置"):alert(b.desc)}})}),u(".rec").click(function(){var a=u(this);u.ajax({url:"http://show.yy.com:85/service/web/dressupcenter/resetdressup",type:"GET",cache:!1,data:{dressUpType:a.attr("type")},dataType:"json",success:function(b){b.result?(a.siblings("seted")&&a.siblings("seted").addClass("set").removeClass("seted").html("设置"),alert("恢复成功！")):m(b.desc)}})}))):m(a.desc)}})}),u(".my-gifts").click(function(){o(),u.ajax({url:"http://show.yy.com:85/service/web/dressupcenter/mysend",type:"GET",cache:!1,dataType:"json",success:function(a){n(),a.result?t(a.data):m(a.desc)}})})});